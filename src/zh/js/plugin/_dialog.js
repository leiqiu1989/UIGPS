define(function(require,exports,module){function t(s,n){if(!(this instanceof arguments.callee))return new t(s,n);this.opts=$.extend({id:"",popClass:"",content:s,mask:!0,type:"alert",title:"",titleClose:!1,cancleText:"取消",btnText:"确定",buttons:!1,animate:!0,center:!/<.+>/.test(s),toastTime:4e3,animateDuration:300,init:$.noop,beforeClose:$.noop},n);var e=this.opts.id;return e&&$["pop_"+e]?$["pop_"+e].show():(this.hasCallback=$.isFunction(this.opts.callback),this.tpl=i,void this.init())}var i='<div class="pop<%= popClass ? (\' \' + popClass) : \'\' %><% if(animate){ %> animate<% } %><% if(type == \'toast\'){ %> pop-toast<% } %>"> <% if(mask){ %> <div class="mask"></div> <% } %> <div class="pop-content <%= type %>"> <% if(title){ %> <h2 class="title"> <%= title %> <% if(titleClose){ %> <i class="cancle-btn">×</i> <% } %> </h2> <% } %> <div class="content<% if(center){ %> center<% } %>"><div><%== content %></div></div> <% if(buttons){ var length = buttons.length; if(length){ %> <div class="pop-btns more"> <% for(var i = 0; i < length; i++){ var btn = buttons[i]; %> <button class="<%= \'pop-btn btn\' + i + \' \' + (btn.className || \'\') %>"><%= btn.name %></button> <% } %> </div> <% } %> <% }else{ %> <% if(type == \'confirm\'){ %> <div class="pop-btns more"> <button class="pop-btn cancle-btn"><%= cancleText %></button> <% }else{ %> <div class="pop-btns"> <% } %> <button class="pop-btn confirm-btn"><%= btnText %></button> </div> <% } %> </div> </div>';$.extend(t.prototype,{init:function(){var t,i=this.opts;"toast"==i.type&&(i.mask=!1),i.buttons&&(i.popClass+=" pop-more-btn"),this.el=$(template.compile(this.tpl)(i)).appendTo("body"),$(document.activeElement).is("input")&&$(document.activeElement).blur(),this.el.find(".content").focus(),this.setPos(),"toast"==i.type?(t=$(".pop-toast").not(this.el),t.length&&t.data("dialog").close()):(this.initClose(),this.initShortcuts(),i.init.call(this)),this.initButtons(),this.el.data("dialog",this),i.id&&($["pop_"+i.id]=this)},initClose:function(){var t=this,i=this.hasCallback;this.el.on("click.dialog",function(s){var n,e=s.target.className;e.indexOf("confirm-btn")>=0?(i&&(n=t.opts.callback.call(t)),n!==!1&&"alert"==t.opts.type&&t.close()):e.indexOf("cancle-btn")>=0?t.close():("pop"==e||"mask"==e)&&!i&&t.close()})},initShortcuts:function(){var t=this;"alert"!=t.opts.type||t.hasCallback||t.opts.buttons||$("body").on("keyup.dialog"+t.opts.id,function(i){27==i.which&&t.close()})},setPos:function(){var t=this,i=$(window).height(),s=this.el.find(".pop-content"),n=this.el.find(".content"),e=n.children().width(),o=e+40,a=/MSIE 7/i.test(navigator.userAgent),l=o/2,c=0;"toast"===this.opts.type?setTimeout(function(){t.close()},t.opts.toastTime):(n.css("max-height",i-250),c=s.height()/2,a&&e&&e>362&&s.width(o)),s.css("margin","-"+c+"px 0 0 -"+l+"px"),t.el.addClass("in")},initButtons:function(){var t=this,i=this.opts.buttons;i.length&&$.each(i,function(i,s){$.isFunction(s.callback)&&t.el.find(".btn"+i).on("click",function(){s.callback.call(this,t)})})},show:function(){var t=this;return this.el.removeClass("hide"),setTimeout(function(){t.el.addClass("in")},0),this},destroy:function(){var t=this.opts.id;this.el.off(".dialog").remove(),t&&($["pop_"+t]=null),$("body").off(".dialog"+t)},close:function(){var t=this;if(t.opts.beforeClose.call(t)!==!1)return t.el.removeClass("in"),setTimeout(function(){t.opts.id?t.el.addClass("hide"):t.destroy()},t.opts.animate?t.opts.animateDuration:0),this}}),module.exports=t});