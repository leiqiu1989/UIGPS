define(function(t,u,r){function f(a,b){if(!(this instanceof arguments.callee))return new f(a,b);this.opts=$.extend(!0,{subBtn:"[type\x3dsubmit]",subBtnWrap:!0,blurTrigger:!1,promptPos:"inline",submit:$.noop,filterEmptyValue:!0,reg:{tel:/^1\d{10}$/,phone:/^0\d{2,3}-\d{7,8}$/,amount:/^\d+(\.\d+)?$/,integer:/^\d*$/,number:/^\d+(\.\d{1,2})?$/,notAllNumber:/\D+/,email:/^.+@.+\..+$/,realName:/^[\u4e00-\u9fa5_a-zA-Z]+$/,url:/^https?/,idCard:/(^\d{15}$)|(^\d{17}(\d|X)$)/i},errorMsg:{required:"\u4e0d\u80fd\u4e3a\u7a7a",min:"\u4e0d\u80fd\u5c0f\u4e8e",max:"\u4e0d\u80fd\u8d85\u8fc7",groupRequired:"\u5fc5\u586b\u4e00\u4e2a",checkbox:"\u8bf7\u9009\u62e9",tel:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",phone:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u8bdd\u53f7\u7801",equals:"\u8f93\u5165\u4e0d\u4e00\u81f4",amount:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u91d1\u989d",integer:"\u8bf7\u8f93\u5165\u6574\u6570",number:"\u8bf7\u8f93\u5165\u6570\u5b57\uff0c\u6700\u591a\u4e24\u4f4d\u5c0f\u6570\u70b9",notAllNumber:"\u4e0d\u80fd\u5168\u662f\u6570\u5b57",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1",realName:"\u53ea\u80fd\u8f93\u5165\u4e2d\u82f1\u6587",url:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u94fe\u63a5\u5730\u5740",idCard:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1"},labelReg:["notAllNumber","integer","number"]},$.validateSetting,b);this.el=$(a);this.subBtn=this.opts.subBtnWrap?this.el.find(this.opts.subBtn):$(this.opts.subBtn);this.inputs=this.el.find("input, select, textarea");this.promptPos=this.opts.promptPos;this.submitCb=this.opts.submit;this.init()}f.prototype={init:function(){var a=this;a.formdata={};a.subBtn.on("click.vd",function(){a.formdata={};a.checkForm()});if(this.opts.blurTrigger)this.inputs.on("blur.vd",function(){a._isSubmit=!1;a._validate($(this))})},checkForm:function(){var a=this;this.el.find(".error-tips").remove();this.inputs.each(function(){a._isSubmit=!0;a._validate($(this))});var b=$.extend({},this.formdata);this.el.find(".input-error").length||(this.submitCb.call(this,b),this.el.data("done")&&this.el.trigger("done",b))},_validate:function(a){var b=this.opts,c=b.errorMsg,d=$.trim(a.val()),h=a.data("type"),g=a[0].type,e=a.attr("name"),l=b.reg[h],f=parseFloat(a.attr("max")),n=parseFloat(a.attr("min")),p=0<=$.inArray(h,this.opts.labelReg)?!0:!1;this.getErrorEl(a).removeClass("input-error");this.getErrorEl(a).parent().find(".error-tips").remove();if(this.hasAttr(a,"vingore")||"hidden"!=a.attr("type")&&!a.is(":hidden")&&!a.prop("disabled")){if(this.hasAttr(a,"required"))if("checkbox"==g)if(e){if(this.inputs.filter('[name\x3d"'+e+'"]').last().is(a)&&!this.formdata[e])return this.addError(a,c.checkbox,!0);if(a.prop("checked"))this.formdata[e]&&(d=this.formdata[e]+","+d);else return}else{if(!a.prop("checked"))return this.addError(a,c.checkbox,!0)}else if(!d)return this.addError(a,c.required,!0);if(this.hasAttr(a,"group-required")){var k=a.attr("group-required"),k=this.el.find('[group-required\x3d"'+k+'"]'),m=k.eq(0),q=k.map(function(){return $(this).prev().length?$.trim($(this).prev().text())||null:null});if(k.filter(function(){return this.value}).length)!m.val()&&m.removeClass("input-error").parent().find(".error-tips").remove();else if(!m.hasClass("input-error"))return this.addError(m,(q.length?Array.prototype.slice.call(q,0).join("\u548c"):"")+c.groupRequired,!1)}if(l&&d&&($.isFunction(l)?!l(d):!l.test(d)))return this.addError(a,c[h],p,1);if(n&&parseFloat(d)<n)return this.addError(a,c.min+n,p,1);if(f&&parseFloat(d)>f)return this.addError(a,c.max+f,p,1);if(this.hasAttr(a,"equals")&&(h=$('[name\x3d"'+a.attr("equals")+'"]').val(),d&&d!=h))return this.addError(a,c.equals,!0,1);e&&("radio"!=g||a.prop("checked"))&&(b.filterEmptyValue?""!==d&&(this.formdata[e]=d):this.formdata[e]=d)}},_resetError:function(){this.el.find(".input-error").removeClass("input-error");this.el.find(".error-tips").remove()},addError:function(a,b,c,d){var f=c?a.prev().length?$.trim(a.prev().text()).replace(/\\uff1a/g,""):"":"";c=this.getErrorEl(a);var g=a.siblings(".validate-tips"),e=(c.data("msg")||"").split("|");b=e[0]?d&&this.hasAttr(a,"required")?e[1]:e[0]:g.length&&g.data("msg")?g.data("msg"):f+b;a='\x3ci class\x3d"error-tips"\x3e'+b+"\x3c/i\x3e";c.addClass("input-error");g.length?g.append(a):c.after(a)},getErrorEl:function(a){var b=a.data("target"),c=a.attr("errorselector");return b?b:c?$(c):a},hasAttr:function(a,b){return"undefined"!==typeof a.attr(b)},done:function(a){var b=this;b.el.on("done",function(c,d){$.isFunction(a)&&a.call(b,d)}).data("done",!0)},destroy:function(){this.subBtn.off(".vd");this.inputs.off(".vd");this.el.off(".vd");this._resetError()}};r.exports=f});